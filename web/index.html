<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tetris - Multiplayer</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="app">
    <!-- Title -->
    <div class="header">
      <h1>TETRIS</h1>
      <p class="subtitle">Web Multiplayer Edition</p>
    </div>

    <!-- Login / Signup Page -->
    <div class="authPage" id="authPage">
      <div class="authContainer">
        <h1 class="authTitle">TETRIS</h1>
        <p class="authSubtitle">Web Multiplayer Edition</p>

        <div class="authCard" id="authCard">
          <!-- Login Tab -->
          <div class="authTabs">
            <button class="authTab active" id="tabLogin" data-tab="login">Log In</button>
            <button class="authTab" id="tabSignup" data-tab="signup">Sign Up</button>
          </div>

          <div class="authForm" id="loginForm">
            <div class="authField">
              <label>Username</label>
              <input type="text" id="loginUsername" placeholder="Enter username" maxlength="20" autocomplete="username" />
            </div>
            <div class="authField">
              <label>Password</label>
              <input type="password" id="loginPassword" placeholder="Enter password" autocomplete="current-password" />
            </div>
            <button class="btn btn-accent authSubmit" id="btnLogin">Log In</button>
            <div class="authError" id="loginError"></div>
          </div>

          <div class="authForm" id="signupForm" style="display:none;">
            <div class="authField">
              <label>Choose a Username</label>
              <input type="text" id="signupUsername" placeholder="2-20 characters" maxlength="20" autocomplete="username" />
            </div>
            <div class="authField">
              <label>Password</label>
              <input type="password" id="signupPassword" placeholder="At least 4 characters" autocomplete="new-password" />
            </div>
            <div class="authField">
              <label>Confirm Password</label>
              <input type="password" id="signupConfirm" placeholder="Repeat password" autocomplete="new-password" />
            </div>
            <button class="btn btn-accent authSubmit" id="btnSignup">Create Account</button>
            <div class="authError" id="signupError"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Welcome Page with Game Mode Cards -->
    <div class="welcomePage" id="welcomePage">
      <div class="welcomeContainer">
        <h1 class="welcomeTitle">TETRIS</h1>
        <p class="welcomeSubtitle">Web Multiplayer Edition</p>

        <!-- Logged-in User Bar -->
        <div class="userBar" id="userBar">
          <span class="userBarIcon">ğŸ‘¤</span>
          <span class="userBarName" id="userBarName">Player</span>
          <span class="userBarCoins">ğŸª™ <span id="userBarCoins">0</span></span>
          <button class="userBarLogout" id="btnLogout">Log Out</button>
        </div>
        
        <div class="gameMode" id="gameModeSelector">
          <!-- Classic Card -->
          <div class="modeCard" id="cardClassic">
            <div class="modeIcon">ğŸ®</div>
            <h2 class="modeName">Classic</h2>
            <p class="modeDescription">Solo gameplay at your own pace. Clear lines, climb the leaderboard, and master the game.</p>
            <div class="modeFeatures">
              <span>âœ“ Single Player</span>
              <span>âœ“ Focus Mode</span>
              <span>âœ“ Track Stats</span>
            </div>
          </div>

          <!-- Online Multiplayer Card -->
          <div class="modeCard" id="cardOnline">
            <div class="modeIcon">ğŸ‘¥</div>
            <h2 class="modeName">Online Multiplayer</h2>
            <p class="modeDescription">Battle up to 4 players online. Share a room code with friends and compete in real-time.</p>
            <div class="modeFeatures">
              <span>âœ“ 1v1 to 4-Player</span>
              <span>âœ“ Real-time Sync</span>
              <span>âœ“ Custom Room Settings</span>
            </div>
          </div>

          <!-- VS AI Card -->
          <div class="modeCard" id="cardAI">
            <div class="modeIcon">ğŸ¤–</div>
            <h2 class="modeName">VS AI</h2>
            <p class="modeDescription">Challenge the AI opponent at adjustable difficulty. See if you can beat the machine!</p>
            <div class="modeFeatures">
              <span>âœ“ Adjustable Difficulty</span>
              <span>âœ“ Same Piece Sequence</span>
              <span>âœ“ Head-to-Head</span>
            </div>
          </div>

          <!-- Leaderboard Card -->
          <div class="modeCard" id="cardLeaderboard">
            <div class="modeIcon">ğŸ†</div>
            <h2 class="modeName">Leaderboard</h2>
            <p class="modeDescription">View top scores and track your progress. Compete for the highest scores.</p>
            <div class="modeFeatures">
              <span>âœ“ Top 50 Scores</span>
              <span>âœ“ Rankings</span>
              <span>âœ“ Best Times</span>
            </div>
          </div>

          <!-- Stats Card -->
          <div class="modeCard" id="cardStats">
            <div class="modeIcon">ğŸ“Š</div>
            <h2 class="modeName">Stats</h2>
            <p class="modeDescription">View your lifetime statistics â€” total lines, games played, average score, and more.</p>
            <div class="modeFeatures">
              <span>âœ“ Lifetime Stats</span>
              <span>âœ“ Personal Bests</span>
              <span>âœ“ Detailed Breakdown</span>
            </div>
          </div>

          <!-- Achievements Card -->
          <div class="modeCard" id="cardAchievements">
            <div class="modeIcon">ğŸ…</div>
            <h2 class="modeName">Achievements</h2>
            <p class="modeDescription">Unlock badges and track your Tetris milestones in the trophy case.</p>
            <div class="modeFeatures">
              <span>âœ“ 16 Achievements</span>
              <span>âœ“ Trophy Case</span>
              <span>âœ“ Milestone Tracking</span>
            </div>
          </div>

          <!-- Replays Card -->
          <div class="modeCard" id="cardReplays">
            <div class="modeIcon">ğŸ¬</div>
            <h2 class="modeName">Replays</h2>
            <p class="modeDescription">Watch recordings of your best games. Save, export, and share replays.</p>
            <div class="modeFeatures">
              <span>âœ“ Record Games</span>
              <span>âœ“ Export/Import</span>
              <span>âœ“ Playback</span>
            </div>
          </div>

          <!-- Ranked 1v1 Card -->
          <div class="modeCard" id="cardRanked">
            <div class="modeIcon">âš”ï¸</div>
            <h2 class="modeName">Ranked 1v1</h2>
            <p class="modeDescription">Compete in ranked matches. Climb the ELO ladder and prove your skill.</p>
            <div class="modeFeatures">
              <span>âœ“ ELO Rating</span>
              <span>âœ“ Matchmaking</span>
              <span>âœ“ Rank Ladder</span>
            </div>
          </div>

          <!-- Shop Card -->
          <div class="modeCard" id="cardShop">
            <div class="modeIcon">ğŸ›’</div>
            <h2 class="modeName">Shop</h2>
            <p class="modeDescription">Spend your hard-earned coins on custom piece skins and block styles.</p>
            <div class="modeFeatures">
              <span>âœ“ Piece Skins</span>
              <span>âœ“ Earn Coins</span>
              <span>âœ“ Customize Blocks</span>
            </div>
          </div>

          <!-- Settings Card -->
          <div class="modeCard" id="cardSettings">
            <div class="modeIcon">âš™ï¸</div>
            <h2 class="modeName">Settings</h2>
            <p class="modeDescription">Customize your controls, keybinds, and game preferences.</p>
            <div class="modeFeatures">
              <span>âœ“ Custom Keybinds</span>
              <span>âœ“ Control Options</span>
              <span>âœ“ Preferences</span>
            </div>
          </div>

          <!-- Profile Card -->
          <div class="modeCard" id="cardProfile">
            <div class="modeIcon">ğŸ‘¤</div>
            <h2 class="modeName">Profile</h2>
            <p class="modeDescription">View your player profile, match history, rank, and earned badges.</p>
            <div class="modeFeatures">
              <span>âœ“ Match History</span>
              <span>âœ“ Rank Display</span>
              <span>âœ“ Badge Showcase</span>
            </div>
          </div>
        </div>

        <p class="welcomeControls">
          <strong>Controls:</strong> â† â†’ Move â€¢ â†‘ Rotate â€¢ Space Hard Drop â€¢ â†“ Soft Drop â€¢ ESC Pause
        </p>

        <!-- Sound Controls -->
        <div class="soundControls">
          <button class="themeBtn" id="soundToggleBtn">ğŸ”Š SFX: On</button>
          <button class="themeBtn" id="musicToggleBtn">ğŸµ Music: On</button>
          <input type="range" id="volumeSlider" min="0" max="100" value="50" class="volumeSlider" title="Volume" />
        </div>

        <!-- Theme Selector -->
        <div class="themeSelector" id="themeSelector">
          <h3 class="themeSelectorTitle">ğŸ¨ Theme</h3>
          <div class="themeOptions" id="themeOptions">
            <button class="themeBtn active" data-theme="neon">ğŸ’œ Neon</button>
            <button class="themeBtn" data-theme="retro">ğŸ•¹ï¸ Retro</button>
            <button class="themeBtn" data-theme="pastel">ğŸŒ¸ Pastel</button>
            <button class="themeBtn" data-theme="monochrome">â¬œ Mono</button>
            <button class="themeBtn" data-theme="ocean">ğŸŒŠ Ocean</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Menu (hidden, kept for compatibility) -->
    <div class="menu" id="menu">
      <div class="status" id="status">Ready</div>
    </div>

    <!-- Pause Menu Overlay -->
    <div class="pauseMenu" id="pauseMenu">
      <div class="pauseContent">
        <h2>PAUSED</h2>
        <p>Press ESC to resume or choose:</p>
        <div class="pauseButtons">
          <button id="btnResume" class="btn btn-accent">Resume Game (ESC)</button>
          <button id="btnBackToMenu" class="btn btn-primary">Back to Menu</button>
          <button id="btnLeaderboardPause" class="btn btn-primary">View Leaderboard</button>
        </div>
      </div>
    </div>

    <!-- Game Over Overlay -->
    <div class="gameOverMenu" id="gameOverMenu">
      <div class="gameOverContent">
        <h2>GAME OVER</h2>
        <div class="gameOverStats">
          <div class="statRow">
            <span class="statLabel">Player:</span>
            <span class="statValue" id="finalPlayerName">Player</span>
          </div>
          <div class="statRow">
            <span class="statLabel">Final Score:</span>
            <span class="statValue" id="finalScore">0</span>
          </div>
          <div class="statRow">
            <span class="statLabel">Lines Cleared:</span>
            <span class="statValue" id="finalLines">0</span>
          </div>
          <div class="statRow">
            <span class="statLabel">Time:</span>
            <span class="statValue" id="finalTime">0:00</span>
          </div>
        </div>
        <div class="gameOverButtons">
          <button id="btnPlayAgain" class="btn btn-accent">Play Again</button>
          <button id="btnSaveReplay" class="btn btn-primary">ğŸ’¾ Save Replay</button>
          <button id="btnGameOverBackToMenu" class="btn btn-primary">Back to Menu</button>
          <button id="btnLeaderboardGameOver" class="btn btn-primary">View Leaderboard</button>
        </div>
      </div>
    </div>

    <!-- Online Form -->
    <div class="onlineForm" id="onlineForm">
      <div class="formWrapper">
        <div class="formStep">
          <div class="stepNumber">1</div>
          <div class="stepContent">
            <label>Room Code</label>
            <input id="room" placeholder="e.g. sam-vs-alex" value="sam-room-1" />
            <span class="formHint">Share this code with your friend</span>
          </div>
        </div>

        <div class="spectatorOption">
          <label class="spectatorToggle">
            <input type="checkbox" id="spectatorCheck" />
            <span class="spectatorLabel">ğŸ‘ Join as Spectator</span>
          </label>
          <span class="formHint">Watch the game without playing</span>
        </div>

        <button id="btnConnect" class="btn btn-accent" style="grid-column: 1 / -1;">
          <span class="btnText">Connect & Play</span>
          <span class="btnLoader"></span>
        </button>
        <button id="btnBackFromOnline" class="btn btn-primary" style="grid-column: 1 / -1;">Back to Menu</button>
      </div>

      <div class="connectingState" id="connectingState">
        <div class="connectingSpinner"></div>
        <div class="connectingText">Connecting...</div>
      </div>

      <div class="waitingState" id="waitingState">
        <div class="waitingPulse"></div>
        <div class="waitingText">Waiting for opponent...</div>
        <div class="waitingHint">Opponent joining room <strong id="sharedRoom"></strong></div>
      </div>

      <div class="lobbyState" id="lobbyState">
        <div class="lobbyContent">
          <h2>Game Lobby</h2>
          <div class="roomCode">Room: <strong id="lobbyRoom"></strong></div>
          <div class="playersList">
            <h3>Players Joined:</h3>
            <div id="playersList" class="playersListItems"></div>
          </div>
          <button id="btnStartGame" class="btn btn-accent">Start Game</button>
          
          <!-- Room Settings -->
          <div class="roomSettingsPanel" id="roomSettingsPanel">
            <h3 class="chatTitle">âš™ï¸ Room Settings</h3>
            <div class="settingRow">
              <label>Starting Level:</label>
              <select id="roomStartLevel"><option value="1" selected>1</option><option value="5">5</option><option value="10">10</option><option value="15">15</option></select>
            </div>
            <div class="settingRow">
              <label>Garbage Multiplier:</label>
              <select id="roomGarbageMult"><option value="0.5">0.5x</option><option value="1" selected>1x</option><option value="1.5">1.5x</option><option value="2">2x</option></select>
            </div>
            <div class="settingRow">
              <label>Speed Multiplier:</label>
              <select id="roomSpeedMult"><option value="0.5">0.5x (Slow)</option><option value="1" selected>1x</option><option value="1.5">1.5x</option><option value="2">2x (Fast)</option></select>
            </div>
          </div>

          <button id="btnLeaveLobby" class="btn btn-primary" style="margin-top: 10px;">Back to Menu</button>
          <div class="waitingForPlayers" id="waitingForPlayers">Waiting for other players...</div>
          
          <!-- Lobby Chat -->
          <div class="lobbyChatBox">
            <h3 class="chatTitle">ğŸ’¬ Chat</h3>
            <div class="chatMessages" id="lobbyChatMessages"></div>
            <div class="chatInputRow">
              <input id="lobbyChatInput" class="chatInput" placeholder="Type a message..." maxlength="200" />
              <button id="lobbyChatSend" class="chatSendBtn">Send</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Leaderboard Page -->
    <div class="leaderboardPage" id="leaderboardPage">
      <div class="leaderboardContent">
        <h2>ğŸ† LEADERBOARD ğŸ†</h2>
        <div class="leaderboardTable">
          <div class="leaderboardHeader">
            <div class="rankCol">Rank</div>
            <div class="nameCol">Player</div>
            <div class="scoreCol">Score</div>
            <div class="linesCol">Lines</div>
            <div class="levelCol">Level</div>
            <div class="timeCol">Time</div>
          </div>
          <div id="leaderboardEntries" class="leaderboardEntries"></div>
        </div>
        <button id="btnBackFromLeaderboard" class="btn btn-accent">Back to Menu</button>
        <button id="btnClearLeaderboard" class="btn btn-secondary">Clear Scores</button>
      </div>
    </div>

    <!-- AI Setup Page -->
    <div class="aiSetupPage" id="aiSetupPage">
      <div class="pageContent">
        <h2>ğŸ¤– VS AI</h2>
        <p style="color:var(--color-text-dim);margin-bottom:20px;">Challenge the AI opponent. You both get the same piece sequence!</p>
        <div class="settingRow" style="margin-bottom:20px;">
          <label>AI Difficulty: <span id="aiDiffLabel">Medium</span></label>
          <input type="range" id="aiDiffSlider" min="0" max="100" value="50" class="volumeSlider" />
        </div>
        <button id="btnStartAI" class="btn btn-accent" style="width:100%;margin-bottom:10px;">Start Match</button>
        <button id="btnBackFromAI" class="btn btn-primary" style="width:100%;">Back to Menu</button>
      </div>
    </div>

    <!-- Stats Dashboard Page -->
    <div class="statsPage" id="statsPage">
      <div class="pageContent">
        <h2>ğŸ“Š Player Stats</h2>
        <div class="gameOverStats" id="statsContent"></div>
        <button id="btnBackFromStats" class="btn btn-accent" style="width:100%;margin-bottom:8px;">Back to Menu</button>
        <button id="btnClearStats" class="btn btn-secondary" style="width:100%;">Reset Stats</button>
      </div>
    </div>

    <!-- Achievements Page -->
    <div class="achievementsPage" id="achievementsPage">
      <div class="pageContent">
        <h2>ğŸ… Achievements</h2>
        <div id="achievementsList" class="achievementsList"></div>
        <button id="btnBackFromAchievements" class="btn btn-accent" style="width:100%;margin-bottom:8px;">Back to Menu</button>
        <button id="btnClearAchievements" class="btn btn-secondary" style="width:100%;">Reset Achievements</button>
      </div>
    </div>

    <!-- Replays Page -->
    <div class="replaysPage" id="replaysPage">
      <div class="pageContent">
        <h2>ğŸ¬ Replays</h2>
        <div id="replaysList" class="replaysList"></div>
        <div style="display:flex;gap:8px;margin-top:16px;">
          <button id="btnExportReplay" class="btn btn-primary" style="flex:1;">ğŸ“¤ Export All</button>
          <button id="btnImportReplay" class="btn btn-primary" style="flex:1;">ğŸ“¥ Import</button>
        </div>
        <button id="btnBackFromReplays" class="btn btn-accent" style="width:100%;margin-top:8px;">Back to Menu</button>
      </div>
    </div>

    <!-- Settings / Keybinds Page -->
    <div class="settingsPage" id="settingsPage">
      <div class="pageContent">
        <h2>âš™ï¸ Settings</h2>
        <h3 style="color:var(--color-accent-cyan);margin:16px 0 12px;">ğŸ® Keybinds</h3>
        <p style="color:var(--color-text-dim);font-size:0.85em;margin-bottom:12px;">Click a binding, then press the key you want to assign.</p>
        <div class="keybindsList" id="keybindsList"></div>
        <button id="btnResetKeybinds" class="btn btn-secondary" style="width:100%;margin-top:12px;">Reset to Defaults</button>
        <button id="btnBackFromSettings" class="btn btn-accent" style="width:100%;margin-top:8px;">Back to Menu</button>
      </div>
    </div>

    <!-- Shop Page -->
    <div class="shopPage" id="shopPage">
      <div class="pageContent shopContent">
        <div class="shopHeader">
          <h2>ğŸ›’ Shop</h2>
          <div class="shopCoinsBar">
            <span class="coinIcon">ğŸª™</span>
            <span class="coinAmount" id="shopCoinDisplay">0</span>
            <span class="coinLabel">coins</span>
          </div>
        </div>
        <h3 class="shopSectionTitle">Piece Skins</h3>
        <p class="shopHint">Earn coins by playing games. Buy and equip skins to customize your blocks!</p>
        <div class="shopGrid" id="shopGrid"></div>
        <button id="btnBackFromShop" class="btn btn-accent" style="width:100%;margin-top:16px;">Back to Menu</button>
      </div>
    </div>

    <!-- Ranked Page -->
    <div class="rankedPage" id="rankedPage">
      <div class="pageContent">
        <h2>âš”ï¸ Ranked 1v1</h2>
        <div class="rankedInfo" id="rankedInfo">
          <div class="rankedRank">
            <span class="rankIcon" id="rankIcon">ğŸ¥‰</span>
            <span class="rankName" id="rankName">Bronze</span>
          </div>
          <div class="rankedElo">
            <span class="eloLabel">ELO</span>
            <span class="eloValue" id="eloValue">1000</span>
          </div>
          <div class="rankedRecord">
            <span id="rankedWins">0</span>W / <span id="rankedLosses">0</span>L
          </div>
        </div>
        <div id="rankedQueueStatus" class="rankedQueueStatus" style="display:none;">Searching for opponent...</div>
        <button id="btnFindRankedMatch" class="btn btn-accent" style="width:100%;margin-bottom:8px;">ğŸ” Find Match</button>
        <button id="btnCancelQueue" class="btn btn-secondary" style="width:100%;margin-bottom:8px;display:none;">Cancel Search</button>
        <h3 style="color:var(--color-accent-cyan);margin:16px 0 8px;">Rank Ladder</h3>
        <div class="rankedLadder" id="rankedLadder"></div>
        <button id="btnBackFromRanked" class="btn btn-accent" style="width:100%;margin-top:12px;">Back to Menu</button>
      </div>
    </div>

    <!-- Profile Page -->
    <div class="profilePage" id="profilePage">
      <div class="pageContent">
        <h2>ğŸ‘¤ Profile</h2>
        <div class="profileCard" id="profileCard">
          <div class="profileHeader">
            <div class="profileAvatar" id="profileAvatar">ğŸ‘¤</div>
            <div class="profileNameSection">
              <h3 id="profileName">Player</h3>
              <span class="profileRank" id="profileRankBadge">ğŸ¥‰ Bronze (1000)</span>
            </div>
          </div>
          <div class="profileStats" id="profileStats"></div>
          <h3 style="color:var(--color-accent-cyan);margin:16px 0 8px;">ğŸ… Badges</h3>
          <div class="profileBadges" id="profileBadges"></div>
          <h3 style="color:var(--color-accent-cyan);margin:16px 0 8px;">ğŸ“œ Match History</h3>
          <div class="matchHistory" id="matchHistory"></div>
        </div>
        <button id="btnBackFromProfile" class="btn btn-accent" style="width:100%;margin-top:12px;">Back to Menu</button>
      </div>
    </div>

    <!-- Game Area -->
    <div class="gameContainer">
      <div class="gameArea" id="gameArea">
        <!-- 2x2 Grid Layout -->
        <div class="playerBoard" id="player1Board">
          <div class="boardHeader">
            <h3 class="playerTitle">You</h3>
            <span class="coinBadge" id="coinBadge">ğŸª™ <span id="coinDisplay">0</span></span>
            <span class="levelBadge">Level <span id="level">1</span></span>
            <span class="timeBadge" id="timeBadge">0:00</span>
          </div>
          <canvas id="board" width="200" height="400" class="mainCanvas"></canvas>
          <div class="boardFooter">
            <div class="footerStat">
              <span class="footerLabel">Score</span>
              <span id="score" class="footerValue">0</span>
            </div>
            <div class="footerStat">
              <span class="footerLabel">Lines</span>
              <span id="lines" class="footerValue">0</span>
            </div>
          </div>
          <div class="nextPieceBox">
            <div class="nextLabel">NEXT</div>
            <canvas id="nextBoard" width="70" height="70"></canvas>
          </div>

          <!-- Piece Statistics -->
          <div class="pieceStatsPanel" id="pieceStatsPanel">
            <div class="panelTitle">PIECES</div>
            <div class="pieceStatRow"><span class="pieceMini" id="miniI">I</span><span class="pieceCount" id="statI">0</span></div>
            <div class="pieceStatRow"><span class="pieceMini" id="miniO">O</span><span class="pieceCount" id="statO">0</span></div>
            <div class="pieceStatRow"><span class="pieceMini" id="miniT">T</span><span class="pieceCount" id="statT">0</span></div>
            <div class="pieceStatRow"><span class="pieceMini" id="miniS">S</span><span class="pieceCount" id="statS">0</span></div>
            <div class="pieceStatRow"><span class="pieceMini" id="miniZ">Z</span><span class="pieceCount" id="statZ">0</span></div>
            <div class="pieceStatRow"><span class="pieceMini" id="miniJ">J</span><span class="pieceCount" id="statJ">0</span></div>
            <div class="pieceStatRow"><span class="pieceMini" id="miniL">L</span><span class="pieceCount" id="statL">0</span></div>
          </div>

          <!-- Back-to-Back Indicator -->
          <div class="b2bIndicator" id="b2bIndicator">B2B</div>
        </div>

        <!-- Player 2 -->
        <div class="playerBoard" id="player2Board">
          <div class="boardHeader">
            <h3 id="player2Name" class="playerTitle">Player 2</h3>
            <span id="status2" class="statusBadge">Ready</span>
          </div>
          <canvas id="board2" width="200" height="400" class="mainCanvas"></canvas>
          <div class="boardFooter">
            <div class="footerStat">
              <span class="footerLabel">Score</span>
              <span id="score2" class="footerValue">0</span>
            </div>
            <div class="footerStat">
              <span class="footerLabel">Lines</span>
              <span id="lines2" class="footerValue">0</span>
            </div>
          </div>
          <div class="nextPieceBox">
            <div class="nextLabel">NEXT</div>
            <canvas id="nextBoard2" width="70" height="70"></canvas>
          </div>
        </div>

        <!-- Player 3 -->
        <div class="playerBoard" id="player3Board">
          <div class="boardHeader">
            <h3 id="player3Name" class="playerTitle">Player 3</h3>
            <span id="status3" class="statusBadge">Ready</span>
          </div>
          <canvas id="board3" width="200" height="400" class="mainCanvas"></canvas>
          <div class="boardFooter">
            <div class="footerStat">
              <span class="footerLabel">Score</span>
              <span id="score3" class="footerValue">0</span>
            </div>
            <div class="footerStat">
              <span class="footerLabel">Lines</span>
              <span id="lines3" class="footerValue">0</span>
            </div>
          </div>
          <div class="nextPieceBox">
            <div class="nextLabel">NEXT</div>
            <canvas id="nextBoard3" width="70" height="70"></canvas>
          </div>
        </div>

        <!-- Player 4 -->
        <div class="playerBoard" id="player4Board">
          <div class="boardHeader">
            <h3 id="player4Name" class="playerTitle">Player 4</h3>
            <span id="status4" class="statusBadge">Ready</span>
          </div>
          <canvas id="board4" width="200" height="400" class="mainCanvas"></canvas>
          <div class="boardFooter">
            <div class="footerStat">
              <span class="footerLabel">Score</span>
              <span id="score4" class="footerValue">0</span>
            </div>
            <div class="footerStat">
              <span class="footerLabel">Lines</span>
              <span id="lines4" class="footerValue">0</span>
            </div>
          </div>
          <div class="nextPieceBox">
            <div class="nextLabel">NEXT</div>
            <canvas id="nextBoard4" width="70" height="70"></canvas>
          </div>
        </div>
      </div>

      <!-- Replay Controls Bar -->
      <div class="replayControlsBar" id="replayControlsBar" style="display:none;">
        <button class="replayCtrlBtn" id="replayPauseBtn" title="Pause / Play">â¸</button>
        <button class="replayCtrlBtn" id="replaySpeedBtn" title="Playback Speed">1x</button>
        <button class="replayCtrlBtn" id="replaySkipBtn" title="Skip to End">â­</button>
        <span class="replayProgressText" id="replayProgressText">0:00</span>
        <div class="replayProgressBar"><div class="replayProgressFill" id="replayProgressFill"></div></div>
        <button class="replayCtrlBtn replayMenuBtn" id="replayMenuBtn" title="Back to Menu">âœ• Menu</button>
      </div>

      <!-- Spectator Banner -->
      <div class="spectatorBanner" id="spectatorBanner" style="display:none;">
        <span class="spectatorIcon">ğŸ‘</span>
        <span>SPECTATING</span>
      </div>

      <!-- Game Chat (Online/Spectator) -->
      <div class="gameChatBox" id="gameChatBox" style="display:none;">
        <div class="chatToggleBtn" id="chatToggle">ğŸ’¬ Chat</div>
        <div class="chatPanel" id="chatPanel">
          <div class="chatMessages" id="gameChatMessages"></div>
          <div class="chatInputRow">
            <input id="gameChatInput" class="chatInput" placeholder="Type..." maxlength="200" />
            <button id="gameChatSend" class="chatSendBtn">Send</button>
          </div>
        </div>
      </div>

      <!-- Controls Panel Below -->
      <div class="controlsFooter">
        <div class="controlsContent">
          <div class="controlsGroup">
            <div class="controlsLabel">KEYBOARD</div>
            <div class="controlRow" id="controlsDisplay">â† / â†’ Move  â€¢  â†‘ Rotate  â€¢  Space Hard Drop  â€¢  â†“ Soft Drop</div>
          </div>
          <div id="mode" class="modeDisplay">Mode: Classic</div>
        </div>
      </div>

      <!-- Mobile Touch Controls Overlay -->
      <div class="touchControls" id="touchControls">
        <div class="touchRow touchRowTop">
          <button class="touchBtn touchRotate" id="touchRotate">â†»</button>
          <button class="touchBtn touchHardDrop" id="touchHardDrop">â¤“</button>
        </div>
        <div class="touchRow touchRowBottom">
          <button class="touchBtn touchLeft" id="touchLeft">â—€</button>
          <button class="touchBtn touchDown" id="touchDown">â–¼</button>
          <button class="touchBtn touchRight" id="touchRight">â–¶</button>
        </div>
      </div>
    </div>

    <!-- Particle Container -->
    <div id="particleContainer" class="particleContainer"></div>
  </div>

  <script src="client.js"></script>
</body>
</html>
